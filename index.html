<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>7K Life – All Modules + Stan AI</title>
  <style>
    :root {
      --bg: #121212;
      --card: #1E1E1E;
      --fg: #EEE;
      --accent: #00BFA5;
      --chat-bg: #1A1A1A;
      --user-bubble: #323232;
      --ai-bubble: #00BFA5;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: var(--bg); color: var(--fg); font-family: sans-serif; line-height: 1.4; }
    .container { max-width: 400px; margin: 20px auto; padding: 10px; }
    .card { background: var(--card); border-radius: 8px; padding: 15px; margin-bottom: 20px; }
    h2 { color: var(--accent); font-size: 1.2em; margin-bottom: 10px; }
    .row { display: flex; align-items: center; justify-content: space-between; margin: 8px 0; }
    button, input, select, textarea { background: none; border: none; color: var(--fg); font-size: 1em; }
    button { cursor: pointer; }
    .btn-circle { width: 30px; height: 30px; border-radius: 50%; background: var(--card); display: flex; align-items: center; justify-content: center; font-size: 1.2em; }
    .toggle { position: relative; width: 40px; height: 20px; }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #555; border-radius: 20px; transition: .3s; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; border-radius: 50%; background: white; top: 2px; left: 2px; transition: .3s; }
    input:checked + .slider { background: var(--accent); }
    input:checked + .slider:before { transform: translateX(20px); }
    input[type=number] { width: 50px; text-align: center; }
    input[type=text], input[type=date], select, textarea {
      width: 100%; padding: 8px; margin: 5px 0; border-radius: 4px; border: 1px solid #333; background: #2A2A2A; color: var(--fg);
    }
    .set-btn { padding: 6px 12px; border: none; border-radius: 4px; background: var(--accent); color: #121212; cursor: pointer; margin-left: 5px; }
    .tasks { list-style: none; max-height: 150px; overflow-y: auto; margin-top: 10px; }
    .tasks li { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #333; }
    .tasks li.completed span { text-decoration: line-through; color: #777; }
    .tasks li span { flex: 1; margin-left: 10px; font-size: 0.95em; }
    .fab { position: fixed; right: 20px; bottom: 20px; width: 56px; height: 56px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #121212; box-shadow: 0 2px 6px rgba(0,0,0,0.5); cursor: pointer; z-index: 1000; }
    .chat-container { display: none; position: fixed; bottom: 80px; right: 20px; width: 320px; max-height: 500px; background: var(--card); border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.7); flex-direction: column; overflow: hidden; z-index: 1000; }
    .chat-header { background: var(--accent); padding: 10px; color: #121212; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
    .chat-body { flex: 1; background: var(--chat-bg); padding: 10px; overflow-y: auto; }
    .chat-input { display: flex; border-top: 1px solid #333; }
    .chat-input input { flex: 1; padding: 10px; border: none; background: #2A2A2A; color: var(--fg); }
    .chat-input button { width: 60px; border: none; background: var(--accent); color: #121212; cursor: pointer; }
    .bubble { margin: 5px 0; padding: 8px 10px; border-radius: 12px; max-width: 80%; word-wrap: break-word; }
    .bubble.user { background: var(--user-bubble); align-self: flex-end; }
    .bubble.ai { background: var(--ai-bubble); align-self: flex-start; color: #121212; }
    .small-text { font-size: 0.85em; color: #AAA; margin-top: 5px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Dashboard Summary -->
    <div class="card">
      <h2>Dashboard</h2>
      <div class="row"><span>Fap Streak:</span><span id="dashStreak">0</span></div>
      <div class="row"><span>Tasks (Done/Total):</span><span id="dashTasks">0/0</span></div>
      <div class="row"><span>Sleep Last Night:</span><span id="dashSleep">0h</span></div>
      <div class="row"><span>Workout Today:</span><span id="dashWorkout">No</span></div>
      <div class="row"><span>Mood:</span><span id="dashMood">—</span></div>
    </div>

    <!-- Habit Tracker -->
    <div class="card">
      <h2>Habit Tracker</h2>
      <div class="row">
        <span>Fap Streak</span>
        <div>
          <button id="decStreak" class="btn-circle">–</button>
          <span id="streakCount">0</span>
          <button id="incStreak" class="btn-circle">+</button>
        </div>
      </div>
      <div class="row">
        <span>Workout Today</span>
        <label class="toggle">
          <input type="checkbox" id="workoutToggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="row">
        <span>Sleep Hours</span>
        <input type="number" id="sleepInput" min="0" max="24">
        <button id="setSleep" class="set-btn">Set</button>
        <span id="sleepDisplay">0h</span>
      </div>
      <div class="row">
        <span>Mood</span>
        <select id="moodSelect">
          <option value="">—</option>
          <option>Happy</option>
          <option>Neutral</option>
          <option>Sad</option>
          <option>Stressed</option>
        </select>
      </div>
    </div>

    <!-- To-Do List -->
    <div class="card">
      <h2>To-Do List</h2>
      <input type="text" id="taskText" placeholder="Add a new task...">
      <input type="date" id="taskDate">
      <button id="addTask" class="set-btn" style="width:100%;">Add Task</button>
      <ul class="tasks" id="taskList"></ul>
    </div>

    <!-- Journal / Notepad -->
    <div class="card">
      <h2>Journal / Notes</h2>
      <textarea id="journalText" rows="6" placeholder="Write your daily reflections..."></textarea>
      <button id="saveJournal" class="set-btn" style="width:100%;">Save Entry</button>
      <div id="journalStatus" class="small-text"></div>
    </div>

    <!-- Study Toolkit -->
    <div class="card">
      <h2>Study Toolkit</h2>
      <select id="subjectSelect">
        <option value="">Select Subject</option>
        <option>History</option>
        <option>Sanskrit</option>
        <option>Hindi</option>
        <option>MCQs (MHCET/CLAT)</option>
        <option>Grammar</option>
        <option>Poetry/Prose</option>
      </select>
      <textarea id="studyNotes" rows="5" placeholder="Add notes/resources..."></textarea>
      <button id="saveStudy" class="set-btn" style="width:100%;">Save Notes</button>
      <div id="studyStatus" class="small-text"></div>
    </div>

    <!-- Mental Wellness Tracker -->
    <div class="card">
      <h2>Mental Wellness</h2>
      <div class="row">
        <span>Current Mood:</span>
        <span id="wellnessMood">—</span>
      </div>
      <textarea id="moodText" rows="3" placeholder="How are you feeling?"></textarea>
      <button id="saveMood" class="set-btn" style="width:100%;">Record Mood</button>
      <div id="moodStatus" class="small-text"></div>
    </div>

    <!-- Offline Resources (placeholders) -->
    <div class="card">
      <h2>Offline Resources</h2>
      <button class="set-btn" style="width:100%;" onclick="alert('Downloading syllabus...')">Download Syllabus (PDF)</button>
      <button class="set-btn" style="width:100%; margin-top:8px;" onclick="alert('Opening practice MCQs...')">Open MCQs (Offline)</button>
      <button class="set-btn" style="width:100%; margin-top:8px;" onclick="alert('Opening grammar guide...')">Grammar Guide (Offline)</button>
    </div>

    <!-- Voice Command (placeholder) -->
    <div class="card">
      <h2>Voice Control</h2>
      <button class="set-btn" style="width:100%;" onclick="alert('Voice command feature coming soon!')">Activate Voice Command</button>
    </div>
  </div>

  <!-- Floating AI Button -->
  <div class="fab" title="Stan AI Assistant" onclick="toggleChat()">
    🤖
  </div>

  <!-- Chat Widget -->
  <div id="chatWidget" class="chat-container">
    <div class="chat-header">
      Stan AI
      <button onclick="toggleChat()" style="background:none;border:none;color:#121212;font-size:1.1em;cursor:pointer;">✕</button>
    </div>
    <div id="chatBody" class="chat-body"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage();">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    // ————— DASHBOARD UPDATES —————
    function updateDashboard() {
      document.getElementById('dashStreak').textContent = streak;
      const total = tasks.length, done = tasks.filter(t => t.done).length;
      document.getElementById('dashTasks').textContent = `${done}/${total}`;
      document.getElementById('dashSleep').textContent = sleepHours + 'h';
      document.getElementById('dashWorkout').textContent = workoutToday ? 'Yes' : 'No';
      document.getElementById('dashMood').textContent = mood || '—';
    }

    // ————— HABIT TRACKER LOGIC —————
    let streak = 0, sleepHours = 0, workoutToday = false, mood = '';
    const streakCount = document.getElementById('streakCount');
    document.getElementById('incStreak').onclick = () => {
      streak++; streakCount.textContent = streak; updateDashboard();
    };
    document.getElementById('decStreak').onclick = () => {
      if (streak > 0) { streak--; streakCount.textContent = streak; updateDashboard(); }
    };
    document.getElementById('workoutToggle').onchange = e => {
      workoutToday = e.target.checked; updateDashboard();
    };
    document.getElementById('setSleep').onclick = () => {
      const val = Number(document.getElementById('sleepInput').value) || 0;
      sleepHours = val;
      document.getElementById('sleepDisplay').textContent = val + 'h';
      updateDashboard();
    };
    document.getElementById('moodSelect').onchange = e => {
      mood = e.target.value; updateDashboard();
    };

    // ————— TO-DO LIST LOGIC —————
    let tasks = [];
    const taskList = document.getElementById('taskList');
    document.getElementById('addTask').onclick = () => {
      const txt = document.getElementById('taskText').value.trim();
      const dt = document.getElementById('taskDate').value;
      if (!txt) return;
      const task = { id: Date.now(), text: txt + (dt ? ' (' + dt + ')' : ''), done: false };
      tasks.unshift(task);
      renderTasks();
      document.getElementById('taskText').value = '';
      document.getElementById('taskDate').value = '';
      updateDashboard();
    };
    function renderTasks() {
      taskList.innerHTML = '';
      tasks.forEach(t => {
        const li = document.createElement('li');
        const chk = document.createElement('input'); chk.type = 'checkbox'; chk.checked = t.done;
        const span = document.createElement('span'); span.textContent = t.text;
        const del = document.createElement('button'); del.textContent = '✕';
        if (t.done) li.classList.add('completed');
        chk.onchange = () => {
          t.done = chk.checked;
          li.classList.toggle('completed');
          updateDashboard();
        };
        del.onclick = () => {
          tasks = tasks.filter(x => x.id !== t.id);
          renderTasks();
          updateDashboard();
        };
        li.append(chk, span, del);
        taskList.append(li);
      });
    }

    // ————— JOURNAL / NOTES LOGIC —————
    const journalStatus = document.getElementById('journalStatus');
    document.getElementById('saveJournal').onclick = () => {
      const txt = document.getElementById('journalText').value.trim();
      if (!txt) { journalStatus.textContent = 'Cannot save empty entry.'; return; }
      localStorage.setItem('journalEntry', txt);
      journalStatus.textContent = 'Journal saved ✔';
      setTimeout(() => journalStatus.textContent = '', 2000);
    };

    // ————— STUDY TOOLKIT LOGIC —————
    const studyStatus = document.getElementById('studyStatus');
    document.getElementById('saveStudy').onclick = () => {
      const sub = document.getElementById('subjectSelect').value;
      const notes = document.getElementById('studyNotes').value.trim();
      if (!sub || !notes) { studyStatus.textContent = 'Select subject & add notes.'; return; }
      localStorage.setItem('studyNotes', JSON.stringify({ subject: sub, notes }));
      studyStatus.textContent = `Saved for ${sub} ✔`;
      setTimeout(() => studyStatus.textContent = '', 2000);
    };

    // ————— MENTAL WELLNESS LOGIC —————
    const wellnessMoodDisplay = document.getElementById('wellnessMood');
    const moodStatus = document.getElementById('moodStatus');
    document.getElementById('saveMood').onclick = () => {
      const mm = document.getElementById('moodSelect').value;
      const txt = document.getElementById('moodText').value.trim();
      if (!mm) { moodStatus.textContent = 'Select current mood.'; return; }
      localStorage.setItem('moodLog', JSON.stringify({ mood: mm, text: txt }));
      wellnessMoodDisplay.textContent = mm;
      moodStatus.textContent = 'Mood recorded ✔';
      setTimeout(() => moodStatus.textContent = '', 2000);
      updateDashboard();
    };

    // ————— LOAD SAVED STATE ON PAGELOAD —————
    window.onload = () => {
      // Journal
      const savedJournal = localStorage.getItem('journalEntry');
      if (savedJournal) document.getElementById('journalText').value = savedJournal;
      // Study Notes
      const sn = JSON.parse(localStorage.getItem('studyNotes') || '{}');
      if (sn.subject) {
        document.getElementById('subjectSelect').value = sn.subject;
        document.getElementById('studyNotes').value = sn.notes;
      }
      // Mood Log
      const mlog = JSON.parse(localStorage.getItem('moodLog') || '{}');
      if (mlog.mood) {
        document.getElementById('wellnessMood').textContent = mlog.mood;
        document.getElementById('moodText').value = mlog.text;
        mood = mlog.mood;
      }
      updateDashboard();
    };

    // ————— STAN AI INTEGRATION —————
    const API_KEY = 'AIzaSyAkom_AkwohBhh9YTp066DpFxjtokobUy4'; // Your Stan API key
    let chatOpen = false;
    function toggleChat() {
      chatOpen = !chatOpen;
      document.getElementById('chatWidget').style.display = chatOpen ? 'flex' : 'none';
      if (chatOpen) document.getElementById('chatInput').focus();
    }

    async function sendMessage() {
      const inputEl = document.getElementById('chatInput');
      const text = inputEl.value.trim();
      if (!text) return;
      appendBubble(text, 'user');
      inputEl.value = '';
      appendBubble('⏳', 'ai'); // temporary “thinking” indicator

      try {
        // Replace with your real Stan‐AI endpoint
        const response = await fetch('https://api.stan.ai/v1/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + API_KEY
          },
          body: JSON.stringify({ message: text })
        });
        const data = await response.json();
        // Expected: { reply: "Stan’s answer text" }
        const replyText = data.reply || 'Stan did not reply.';
        // Remove the “thinking” bubble and append actual reply
        removeLastAIBubble();
        appendBubble(replyText, 'ai');
      } catch (err) {
        removeLastAIBubble();
        appendBubble('Error: Could not reach Stan.', 'ai');
        console.error('Stan AI error:', err);
      }
    }

    function appendBubble(msg, who) {
      const body = document.getElementById('chatBody');
      const div = document.createElement('div');
      div.className = `bubble ${who}`;
      div.textContent = msg;
      body.append(div);
      body.scrollTop = body.scrollHeight;
    }

    function removeLastAIBubble() {
      const bubbles = document.querySelectorAll('.bubble.ai');
      if (bubbles.length) bubbles[bubbles.length - 1].remove();
    }
  </script>
</body>
    </html>
