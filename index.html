<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7K Life</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ============================ */
        /* Global CSS Settings & Variables */
        /* ============================ */
        :root {
            --pure-white: #FFFFFF;
            --jet-black: #000000;
            --medium-gray: #B0B0B0;
            --electric-blue: #007BFF;
            --light-gray: #F0F0F0;
            --dark-gray: #202020;
            --soft-blue: #339AFF;
            --placeholder-gray: #8A8A8A;
            --danger-red: #DC3545;
            --success-green: #28A745;
            --warning-orange: #FFC107;
            --font-family: 'Roboto', sans-serif;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            width: 100%;
            background-color: var(--light-gray);
            font-family: var(--font-family);
            color: var(--dark-gray);
            overflow-x: hidden;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--medium-gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-gray);
        }

        /* ============================ */
        /* Layout: Header, Sidebar, Main */
        /* ============================ */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: var(--pure-white);
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }

        .header-left .hamburger-menu, .header-right .ai-icon {
            font-size: 1.8rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .header-left .hamburger-menu:hover, .header-right .ai-icon:hover {
            color: var(--electric-blue);
        }

        .app-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--electric-blue);
            cursor: pointer;
        }

        #sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 250px;
            height: calc(100% - 60px);
            background-color: var(--pure-white);
            border-right: 1px solid var(--medium-gray);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 999;
            overflow-y: auto;
        }

        body.sidebar-open #sidebar {
            transform: translateX(0);
        }

        .main-content {
            margin-top: 60px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        @media (min-width: 1024px) {
            #sidebar {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 250px;
            }
            .hamburger-menu {
                display: none;
            }
        }

        /* ============================ */
        /* Sidebar Navigation         */
        /* ============================ */
        .nav-list {
            list-style: none;
            padding: 10px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            border-left: 4px solid transparent;
        }

        .nav-item .icon {
            font-size: 1.25rem;
            margin-right: 15px;
            width: 24px;
            text-align: center;
        }

        .nav-item .label {
            font-size: 1rem;
            font-weight: 400;
        }

        .nav-item:hover {
            background-color: var(--light-gray);
        }

        .nav-item.active {
            background-color: var(--electric-blue);
            color: var(--pure-white);
            border-left-color: var(--soft-blue);
        }
        
        .nav-item.active .label, .nav-item.active .icon {
            color: var(--pure-white);
        }


        /* ============================ */
        /* Main Content Sections      */
        /* ============================ */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        /* ============================ */
        /* Helper & Component Classes   */
        /* ============================ */
        .card {
            background: var(--pure-white);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: var(--electric-blue);
            color: var(--pure-white);
        }
        .btn-primary:hover {
            background-color: var(--soft-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }
        
        .btn-danger {
            background-color: var(--danger-red);
            color: var(--pure-white);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            animation: slideDown 0.4s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 700;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
        }
        .form-group input::placeholder, .form-group textarea::placeholder {
            color: var(--placeholder-gray);
            font-style: italic;
        }

        /* ============================ */
        /* To-Do List Section         */
        /* ============================ */
        #todo-list {
            list-style: none;
        }
        .todo-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #fff;
            border: 1px solid #eee;
            margin-bottom: 10px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .todo-item.completed .todo-title {
            text-decoration: line-through;
            color: var(--medium-gray);
        }
        .todo-item input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }
        .todo-title {
            flex-grow: 1;
        }
        .todo-actions button {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2rem;
        }
        
        /* ============================ */
        /* Habit Tracker Section      */
        /* ============================ */
        .habit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .habit-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .habit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .habit-title { font-size: 1.2rem; font-weight: 700; }
        .habit-streak { font-size: 1.5rem; color: var(--electric-blue); font-weight: 700; }
        .habit-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        .calendar-day {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            background: #eee;
        }
        .calendar-day.completed {
            background: var(--success-green);
        }
        
        /* ============================ */
        /* Journal Section            */
        /* ============================ */
        .journal-layout {
            display: flex;
            gap: 20px;
        }
        #journal-list-container {
            flex: 0 0 300px;
        }
        #journal-entry-list { list-style: none; }
        .journal-list-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .journal-list-item:hover { background: #f9f9f9; }
        .journal-list-item.active { background: var(--soft-blue); color: white; }
        
        #journal-editor-container {
            flex-grow: 1;
        }
        #journal-title-display, #journal-content-display {
             background: white; padding: 15px; border-radius: 4px;
        }
         #journal-title-display { font-size: 1.5rem; font-weight: bold; margin-bottom: 10px; }


        /* ============================ */
        /* Notepad Section             */
        /* ============================ */
        #notepad-textarea {
            width: 100%;
            height: 60vh;
            padding: 15px;
            font-family: 'Courier New', monospace;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            resize: vertical;
        }
        .notepad-actions { margin-top: 10px; display: flex; gap: 10px;}

        /* ============================ */
        /* Study Hub Section          */
        /* ============================ */
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 700;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active { border-bottom-color: var(--electric-blue); color: var(--electric-blue); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #quiz-container { display: none; }
        .quiz-question { margin-bottom: 20px; }
        .quiz-options button {
            display: block; width: 100%; text-align: left;
            padding: 10px; margin: 5px 0;
            background: #fff; border: 1px solid #ddd;
            border-radius: 4px; cursor: pointer;
        }
        .quiz-options button:hover { background: #f0f0f0; }
        .quiz-options button.correct { background: var(--success-green); color: white; }
        .quiz-options button.incorrect { background: var(--danger-red); color: white; }
        #quiz-results { display: none; }

        /* ============================ */
        /* AI Chat Panel              */
        /* ============================ */
        #aiChatPanel {
            position: fixed;
            top: 60px;
            right: 0;
            width: 350px;
            height: calc(100% - 60px);
            background: var(--pure-white);
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }
        body.ai-panel-open #aiChatPanel { transform: translateX(0); }

        .ai-chat-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .ai-chat-window {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .chat-message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
        }
        .user-message {
            background: var(--electric-blue);
            color: white;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
        }
        .ai-message {
            background: var(--light-gray);
            color: var(--dark-gray);
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }
        .ai-input-area {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }
        #ai-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <span class="hamburger-menu">☰</span>
        </div>
        <div class="app-logo">7K Life</div>
        <div class="header-right">
            <span class="ai-icon">🤖</span>
        </div>
    </header>

    <aside id="sidebar">
        <nav>
            <ul class="nav-list">
                <li data-target="dashboardSection" class="nav-item active">
                    <span class="icon">🏠</span><span class="label">Dashboard</span>
                </li>
                <li data-target="todoSection" class="nav-item">
                    <span class="icon">✅</span><span class="label">To-Do List</span>
                </li>
                <li data-target="habitSection" class="nav-item">
                    <span class="icon">🏋️</span><span class="label">Habit Tracker</span>
                </li>
                <li data-target="journalSection" class="nav-item">
                    <span class="icon">📓</span><span class="label">Journal</span>
                </li>
                <li data-target="notepadSection" class="nav-item">
                    <span class="icon">📝</span><span class="label">Notepad</span>
                </li>
                <li data-target="studySection" class="nav-item">
                    <span class="icon">📚</span><span class="label">Study Hub</span>
                </li>
                <li data-target="settingsSection" class="nav-item">
                    <span class="icon">⚙️</span><span class="label">Settings</span>
                </li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <section id="dashboardSection" class="content-section active">
            <h2>Dashboard</h2>
            <div class="card">
                <h3>Welcome!</h3>
                <p>This is your all-in-one productivity hub. Select a module from the sidebar to get started.</p>
            </div>
        </section>

        <section id="todoSection" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>To-Do List</h2>
                <button id="add-task-btn" class="btn btn-primary">Add Task</button>
            </div>
            <div class="card">
                <ul id="todo-list">
                    </ul>
            </div>
        </section>
        
        <section id="habitSection" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Habit Tracker</h2>
                <button id="add-habit-btn" class="btn btn-primary">Add Habit</button>
            </div>
            <div id="habit-grid-container" class="habit-grid">
                </div>
        </section>

        <section id="journalSection" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Journal</h2>
                <button id="new-entry-btn" class="btn btn-primary">New Entry</button>
            </div>
            <div class="journal-layout">
                <div id="journal-list-container" class="card">
                    <h3>Entries</h3>
                    <ul id="journal-entry-list"></ul>
                </div>
                <div id="journal-editor-container" class="card">
                    <div id="journal-viewer">
                        <h3 id="journal-title-display">Select an entry to read</h3>
                        <div id="journal-content-display"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="notepadSection" class="content-section">
            <h2>Notepad</h2>
            <div class="card">
                <textarea id="notepad-textarea" placeholder="Start writing your notes here..."></textarea>
                <div class="notepad-actions">
                    <button id="save-note-btn" class="btn btn-primary">Save Note</button>
                    <button id="clear-note-btn" class="btn btn-danger">Clear All</button>
                </div>
            </div>
        </section>

        <section id="studySection" class="content-section">
            <h2>Study Hub</h2>
            <div class="card">
                <div id="quiz-setup">
                    <h3>Start a Quiz</h3>
                    <div class="form-group">
                        <label for="quiz-topic">Select Topic:</label>
                        <select id="quiz-topic" class="form-group">
                            <option value="clat_english">CLAT - English</option>
                            <option value="mhcet_math">MHCET - Mathematics</option>
                        </select>
                    </div>
                    <button id="start-quiz-btn" class="btn btn-primary">Start Quiz</button>
                </div>

                <div id="quiz-container">
                    <h3 id="quiz-question-title"></h3>
                    <div id="quiz-options" class="quiz-options"></div>
                    <button id="next-question-btn" class="btn btn-primary" style="margin-top: 20px;">Next</button>
                </div>

                <div id="quiz-results">
                    <h3>Quiz Over!</h3>
                    <p id="quiz-score"></p>
                    <button id="restart-quiz-btn" class="btn btn-primary">Try Again</button>
                </div>
            </div>
        </section>

        <section id="settingsSection" class="content-section">
            <h2>Settings</h2>
            <div class="card">
                <h3>Data Management</h3>
                <div class="form-group">
                    <label for="api-key-input">Gemini API Key</label>
                    <input type="password" id="api-key-input" placeholder="Enter your Gemini API Key">
                    <button id="save-api-key-btn" class="btn btn-primary" style="margin-top: 10px;">Save Key</button>
                </div>
                <hr style="margin: 20px 0;">
                <button id="export-data-btn" class="btn btn-primary">Export All Data</button>
                <button id="clear-data-btn" class="btn btn-danger">Clear All Data</button>
            </div>
        </section>
    </main>
    
    <aside id="aiChatPanel">
        <div class="ai-chat-header">
            <h3>AI Assistant</h3>
            <span id="close-ai-panel" class="close-btn">&times;</span>
        </div>
        <div class="ai-chat-window" id="ai-chat-window">
             </div>
        <div class="ai-input-area">
            <input type="text" id="ai-input" placeholder="Ask me anything...">
            <button id="ai-send-btn" class="btn btn-primary">Send</button>
        </div>
    </aside>

    <div id="task-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3 id="modal-title">Add Task</h3>
        <form id="task-form">
          <input type="hidden" id="task-id">
          <div class="form-group">
            <label for="task-title">Title</label>
            <input type="text" id="task-title" required>
          </div>
          <button type="submit" class="btn btn-primary">Save Task</button>
        </form>
      </div>
    </div>
    
    <div id="habit-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3>Add Habit</h3>
        <form id="habit-form">
          <div class="form-group">
            <label for="habit-title-input">Habit Name</label>
            <input type="text" id="habit-title-input" required placeholder="e.g., Read for 30 minutes">
          </div>
          <button type="submit" class="btn btn-primary">Save Habit</button>
        </form>
      </div>
    </div>

    <div id="journal-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h3>New Journal Entry</h3>
        <form id="journal-form">
            <input type="hidden" id="journal-id">
            <div class="form-group">
                <label for="journal-title-input">Title</label>
                <input type="text" id="journal-title-input" required>
            </div>
            <div class="form-group">
                <label for="journal-content-input">Content</label>
                <textarea id="journal-content-input" rows="10" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Save Entry</button>
        </form>
      </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // ============================
            // State Management & Constants
            // ============================
            const GEMINI_API_KEY = "AIzaSyAkom_AkwohBhh9YTp066DpFxjtokobUy4"; // As requested
            let state = {
                todos: [],
                habits: [],
                journalEntries: [],
                notepadContent: '',
                settings: {
                    apiKey: ''
                },
                quizHistory: [],
            };
            
            const quizBank = {
                clat_english: [
                    { question: "Which of the following is a synonym for 'ephemeral'?", options: ["Eternal", "Transient", "Strong", "Beautiful"], answer: "Transient" },
                    { question: "Identify the correct spelling.", options: ["Mischievious", "Mischeivous", "Mischievous", "Mischevious"], answer: "Mischievous" },
                ],
                mhcet_math: [
                    { question: "What is the value of 5! (5 factorial)?", options: ["25", "120", "60", "100"], answer: "120" },
                    { question: "If a triangle has angles 45, 45, and x, what is x?", options: ["45", "90", "60", "180"], answer: "90" },
                ]
            };


            // ============================
            // DOM Element Selectors
            // ============================
            const mainContent = document.querySelector('.main-content');
            const navItems = document.querySelectorAll('.nav-item');
            const contentSections = document.querySelectorAll('.content-section');
            const hamburgerMenu = document.querySelector('.hamburger-menu');
            const aiIcon = document.querySelector('.ai-icon');
            const aiChatPanel = document.getElementById('aiChatPanel');
            const closeAiPanelBtn = document.getElementById('close-ai-panel');

            // ============================
            // General App Initialization
            // ============================
            function init() {
                loadState();
                initNavigation();
                initToDoModule();
                initHabitModule();
                initJournalModule();
                initNotepadModule();
                initStudyModule();
                initSettingsModule();
                initAIModule();
            }

            function loadState() {
                const savedState = localStorage.getItem('7kLifeState');
                if (savedState) {
                    state = JSON.parse(savedState);
                }
                // Use the hardcoded key if no user key is saved
                if (!state.settings.apiKey) {
                    state.settings.apiKey = GEMINI_API_KEY;
                }
            }

            function saveState() {
                localStorage.setItem('7kLifeState', JSON.stringify(state));
            }

            // ============================
            // Navigation
            // ============================
            function initNavigation() {
                navItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const targetId = item.getAttribute('data-target');
                        
                        navItems.forEach(nav => nav.classList.remove('active'));
                        item.classList.add('active');
                        
                        contentSections.forEach(section => {
                            section.classList.remove('active');
                            if (section.id === targetId) {
                                section.classList.add('active');
                            }
                        });

                        if (window.innerWidth < 1024) {
                            document.body.classList.remove('sidebar-open');
                        }
                    });
                });
                
                hamburgerMenu.addEventListener('click', () => document.body.classList.toggle('sidebar-open'));
                aiIcon.addEventListener('click', () => document.body.classList.add('ai-panel-open'));
                closeAiPanelBtn.addEventListener('click', () => document.body.classList.remove('ai-panel-open'));
                document.querySelector('.app-logo').addEventListener('click', () => {
                    document.querySelector('.nav-item[data-target="dashboardSection"]').click();
                });
            }

            // ============================
            // Modal Helpers
            // ============================
            function openModal(modalId) { document.getElementById(modalId).style.display = 'block'; }
            function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
            document.querySelectorAll('.modal .close-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.target.closest('.modal').style.display = 'none';
                });
            });

            // ============================
            // To-Do Module
            // ============================
            function initToDoModule() {
                const todoList = document.getElementById('todo-list');
                const addTaskBtn = document.getElementById('add-task-btn');
                const taskModal = document.getElementById('task-modal');
                const taskForm = document.getElementById('task-form');
                const taskIdInput = document.getElementById('task-id');
                const taskTitleInput = document.getElementById('task-title');

                function renderTodos() {
                    todoList.innerHTML = '';
                    if (state.todos.length === 0) {
                        todoList.innerHTML = '<p>No tasks yet. Add one!</p>';
                        return;
                    }
                    state.todos.forEach(todo => {
                        const li = document.createElement('li');
                        li.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                        li.dataset.id = todo.id;
                        li.innerHTML = `
                            <input type="checkbox" ${todo.completed ? 'checked' : ''}>
                            <span class="todo-title">${todo.title}</span>
                            <div class="todo-actions">
                                <button class="delete-btn">🗑️</button>
                            </div>
                        `;
                        todoList.appendChild(li);
                    });
                }
                
                addTaskBtn.addEventListener('click', () => {
                    taskForm.reset();
                    taskIdInput.value = '';
                    document.getElementById('modal-title').innerText = 'Add Task';
                    openModal('task-modal');
                });

                taskForm.addEventListener('submit', e => {
                    e.preventDefault();
                    const title = taskTitleInput.value.trim();
                    if (!title) return;
                    
                    const newTodo = { id: Date.now(), title, completed: false };
                    state.todos.push(newTodo);
                    
                    saveState();
                    renderTodos();
                    closeModal('task-modal');
                });
                
                todoList.addEventListener('click', e => {
                    const target = e.target;
                    const todoItem = target.closest('.todo-item');
                    if (!todoItem) return;
                    const todoId = Number(todoItem.dataset.id);

                    if (target.type === 'checkbox') {
                        const todo = state.todos.find(t => t.id === todoId);
                        todo.completed = target.checked;
                    } else if (target.classList.contains('delete-btn')) {
                        state.todos = state.todos.filter(t => t.id !== todoId);
                    }
                    saveState();
                    renderTodos();
                });

                renderTodos();
            }

            // ============================
            // Habit Module
            // ============================
            function initHabitModule() {
                const habitGrid = document.getElementById('habit-grid-container');
                const addHabitBtn = document.getElementById('add-habit-btn');
                const habitForm = document.getElementById('habit-form');
                const habitTitleInput = document.getElementById('habit-title-input');

                function renderHabits() {
                    habitGrid.innerHTML = '';
                    if(state.habits.length === 0) {
                        habitGrid.innerHTML = '<p>No habits being tracked. Add one to start!</p>';
                        return;
                    }
                    state.habits.forEach(habit => {
                        const today = new Date().toISOString().split('T')[0];
                        const completedToday = habit.completedOn.includes(today);

                        const card = document.createElement('div');
                        card.className = 'habit-card';
                        card.dataset.id = habit.id;
                        card.innerHTML = `
                            <div class="habit-header">
                                <h4 class="habit-title">${habit.title}</h4>
                                <span class="habit-streak">🔥 ${habit.streak}</span>
                            </div>
                            <p>Completed today: ${completedToday ? 'Yes' : 'No'}</p>
                            <button class="complete-habit-btn btn ${completedToday ? '' : 'btn-primary'}" ${completedToday ? 'disabled' : ''}>
                                ${completedToday ? 'Done for Today!' : 'Mark as Done'}
                            </button>
                        `;
                        habitGrid.appendChild(card);
                    });
                }
                
                addHabitBtn.addEventListener('click', () => openModal('habit-modal'));

                habitForm.addEventListener('submit', e => {
                    e.preventDefault();
                    const title = habitTitleInput.value.trim();
                    if (!title) return;

                    const newHabit = {
                        id: Date.now(),
                        title,
                        streak: 0,
                        completedOn: []
                    };
                    state.habits.push(newHabit);
                    saveState();
                    renderHabits();
                    closeModal('habit-modal');
                });
                
                habitGrid.addEventListener('click', e => {
                    if (e.target.classList.contains('complete-habit-btn')) {
                        const habitId = Number(e.target.closest('.habit-card').dataset.id);
                        const habit = state.habits.find(h => h.id === habitId);
                        const today = new Date().toISOString().split('T')[0];
                        if (!habit.completedOn.includes(today)) {
                            habit.completedOn.push(today);
                            habit.streak++; // Simple streak logic
                            saveState();
                            renderHabits();
                        }
                    }
                });

                renderHabits();
            }

            // ============================
            // Journal Module
            // ============================
            function initJournalModule() {
                const newEntryBtn = document.getElementById('new-entry-btn');
                const journalForm = document.getElementById('journal-form');
                const journalList = document.getElementById('journal-entry-list');
                const titleDisplay = document.getElementById('journal-title-display');
                const contentDisplay = document.getElementById('journal-content-display');

                function renderJournalList() {
                    journalList.innerHTML = '';
                    state.journalEntries.sort((a, b) => b.id - a.id).forEach(entry => {
                        const li = document.createElement('li');
                        li.className = 'journal-list-item';
                        li.dataset.id = entry.id;
                        li.textContent = entry.title;
                        journalList.appendChild(li);
                    });
                }

                function viewJournalEntry(id) {
                    const entry = state.journalEntries.find(e => e.id === id);
                    if (entry) {
                        titleDisplay.textContent = entry.title;
                        contentDisplay.innerHTML = entry.content.replace(/\n/g, '<br>'); // Display newlines correctly
                    }
                }
                
                newEntryBtn.addEventListener('click', () => {
                    journalForm.reset();
                    document.getElementById('journal-id').value = '';
                    openModal('journal-modal');
                });
                
                journalForm.addEventListener('submit', e => {
                    e.preventDefault();
                    const title = document.getElementById('journal-title-input').value.trim();
                    const content = document.getElementById('journal-content-input').value.trim();
                    if(!title || !content) return;

                    const newEntry = { id: Date.now(), title, content };
                    state.journalEntries.push(newEntry);
                    saveState();
                    renderJournalList();
                    viewJournalEntry(newEntry.id);
                    closeModal('journal-modal');
                });
                
                journalList.addEventListener('click', e => {
                    if (e.target.classList.contains('journal-list-item')) {
                        const id = Number(e.target.dataset.id);
                        viewJournalEntry(id);
                        document.querySelectorAll('.journal-list-item').forEach(i => i.classList.remove('active'));
                        e.target.classList.add('active');
                    }
                });
                
                renderJournalList();
            }

            // ============================
            // Notepad Module
            // ============================
            function initNotepadModule() {
                const notepad = document.getElementById('notepad-textarea');
                const saveBtn = document.getElementById('save-note-btn');
                const clearBtn = document.getElementById('clear-note-btn');

                notepad.value = state.notepadContent;

                saveBtn.addEventListener('click', () => {
                    state.notepadContent = notepad.value;
                    saveState();
                    alert('Note saved!');
                });

                clearBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to clear the notepad?')) {
                        notepad.value = '';
                        state.notepadContent = '';
                        saveState();
                    }
                });
            }

            // ============================
            // Study Hub Module
            // ============================
            function initStudyModule() {
                const quizSetup = document.getElementById('quiz-setup');
                const quizContainer = document.getElementById('quiz-container');
                const quizResults = document.getElementById('quiz-results');
                const startBtn = document.getElementById('start-quiz-btn');
                const restartBtn = document.getElementById('restart-quiz-btn');
                const nextBtn = document.getElementById('next-question-btn');
                const questionTitle = document.getElementById('quiz-question-title');
                const optionsContainer = document.getElementById('quiz-options');
                
                let currentQuiz = [];
                let currentQuestionIndex = 0;
                let score = 0;

                function startQuiz() {
                    const topic = document.getElementById('quiz-topic').value;
                    currentQuiz = quizBank[topic];
                    currentQuestionIndex = 0;
                    score = 0;
                    
                    quizSetup.style.display = 'none';
                    quizResults.style.display = 'none';
                    quizContainer.style.display = 'block';
                    
                    showQuestion();
                }

                function showQuestion() {
                    const question = currentQuiz[currentQuestionIndex];
                    questionTitle.textContent = question.question;
                    optionsContainer.innerHTML = '';
                    question.options.forEach(option => {
                        const button = document.createElement('button');
                        button.textContent = option;
                        button.onclick = () => selectAnswer(button, option, question.answer);
                        optionsContainer.appendChild(button);
                    });
                }

                function selectAnswer(button, selected, correct) {
                    Array.from(optionsContainer.children).forEach(btn => {
                        btn.disabled = true;
                        if (btn.textContent === correct) {
                            btn.classList.add('correct');
                        }
                    });
                    if (selected === correct) {
                        score++;
                    } else {
                        button.classList.add('incorrect');
                    }
                    nextBtn.style.display = 'block';
                }

                function nextQuestion() {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < currentQuiz.length) {
                        showQuestion();
                        nextBtn.style.display = 'none';
                        Array.from(optionsContainer.children).forEach(btn => btn.disabled = false);
                    } else {
                        showResults();
                    }
                }
                
                function showResults() {
                    quizContainer.style.display = 'none';
                    quizResults.style.display = 'block';
                    document.getElementById('quiz-score').textContent = `You scored ${score} out of ${currentQuiz.length}!`;
                }

                startBtn.addEventListener('click', startQuiz);
                nextBtn.addEventListener('click', nextQuestion);
                restartBtn.addEventListener('click', () => {
                     quizSetup.style.display = 'block';
                     quizResults.style.display = 'none';
                });
            }

            // ============================
            // Settings Module
            // ============================
            function initSettingsModule() {
                const apiKeyInput = document.getElementById('api-key-input');
                const saveKeyBtn = document.getElementById('save-api-key-btn');
                const exportBtn = document.getElementById('export-data-btn');
                const clearBtn = document.getElementById('clear-data-btn');

                apiKeyInput.value = state.settings.apiKey || '';

                saveKeyBtn.addEventListener('click', () => {
                    state.settings.apiKey = apiKeyInput.value.trim();
                    saveState();
                    alert('API Key saved!');
                });

                exportBtn.addEventListener('click', () => {
                    const dataStr = JSON.stringify(state, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = '7k-life-backup.json';
                    a.click();
                    URL.revokeObjectURL(url);
                });
                
                clearBtn.addEventListener('click', () => {
                    if (confirm('DANGER! This will delete ALL your data. Are you absolutely sure?')) {
                        localStorage.removeItem('7kLifeState');
                        window.location.reload();
                    }
                });
            }
            
            // ============================
            // AI Module
            // ============================
            function initAIModule() {
                const sendBtn = document.getElementById('ai-send-btn');
                const input = document.getElementById('ai-input');
                const chatWindow = document.getElementById('ai-chat-window');
                
                async function queryAI(promptText) {
                    if (!state.settings.apiKey) {
                        return "API Key not set. Please add it in Settings.";
                    }
                    
                    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${state.settings.apiKey}`;
                    
                    try {
                        const response = await fetch(API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{ text: promptText }]
                                }]
                            })
                        });
                        if (!response.ok) {
                             const errorBody = await response.json();
                             console.error("API Error:", errorBody);
                             return `Error: ${errorBody.error.message}`;
                        }
                        const data = await response.json();
                        return data.candidates[0].content.parts[0].text;
                    } catch (error) {
                        console.error("Fetch Error:", error);
                        return "Sorry, I couldn't connect to the AI service.";
                    }
                }
                
                function addMessage(text, sender) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `chat-message ${sender}-message`;
                    messageDiv.textContent = text;
                    chatWindow.appendChild(messageDiv);
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                }
                
                async function handleAISubmit() {
                    const prompt = input.value.trim();
                    if (!prompt) return;
                    
                    addMessage(prompt, 'user');
                    input.value = '';
                    input.disabled = true;

                    addMessage("Thinking...", 'ai');
                    const aiResponse = await queryAI(prompt);
                    
                    // Remove "Thinking..." message
                    chatWindow.removeChild(chatWindow.lastChild);
                    addMessage(aiResponse, 'ai');
                    input.disabled = false;
                    input.focus();
                }

                sendBtn.addEventListener('click', handleAISubmit);
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleAISubmit();
                });
            }

            // Run application
            init();
        });
    </script>
</body>
</html>
